version: 1.4.0-win-{build}
image: Visual Studio 2019 Preview
configuration: Release
platform: x64
dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'
environment:
  CppCompilerAndLinker: clang
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
  NUGET_XMLDOC_MODE: skip
  NUGET_PACKAGES: 'C:\projects\fata-morgana\packages'
cache:
  - 'packages'
before_build:
- pwsh: >-
    Invoke-WebRequest "https://download.visualstudio.microsoft.com/download/pr/4e73514f-0646-4600-bdc2-38c90fc207b6/22ad70cbe1a254177e6d7b7f7e7425f8/dotnet-sdk-3.0.100-preview6-012264-win-x64.zip" -OutFile "dotnet-sdk-3.0.100-preview6-012264-win-x64.zip"

    Expand-Archive "dotnet-sdk-3.0.100-preview6-012264-win-x64.zip" -DestinationPath "dotnet"

    Set-Item Env:Path "C:\projects\fata-morgana\dotnet;$Env:Path"
build_script:
- pwsh: .\dotnet\dotnet.exe publish -c Release -r win-x64 -o dist --version-suffix "win-$APPVEYOR_BUILD_NUMBER"
artifacts:
- path: 'dist\'
